{"filter":false,"title":"ratesBank.js","tooltip":"/functions/getRates/ratesBank.js","undoManager":{"mark":12,"position":12,"stack":[[{"start":{"row":0,"column":0},"end":{"row":1,"column":13},"action":"insert","lines":["/*jslint node: true, asi:true */","'use strict';"],"id":1}],[{"start":{"row":1,"column":13},"end":{"row":2,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":3,"column":0},"action":"remove","lines":["/*jslint node: true, asi:true */","'use strict';","",""],"id":4},{"start":{"row":0,"column":0},"end":{"row":82,"column":1},"action":"insert","lines":["/*jslint node: true, asi:true */","'use strict';","module.exports = function ratesBankStandard(timestamp, callback) {","\tvar https = require('https');","\tvar options = {","\t\thostname: 'bankstandard.com',","\t\tpath: '/az/',","\t\tmethod: 'GET'","\t}","","\tvar req = https.request(options, function(res) {","\t\tvar data = '';","\t\tres.setEncoding('utf8');","\t\tres.on('data', function(chunk) {","\t\t\tdata += chunk.toString();","\t\t});","\t\tres.on('end', function() {","\t\t\ttry {","\t\t\t\tvar string = data;","\t\t\t\tstring = string.match(/currency_wrapper index((.|\\s)*?<\\/div>){5}/);","\t\t\t\tstring = string[0].match(/\\d{2}\\.\\d{2}\\.\\d{4}/);","\t\t\t\tvar date = string[0];","","","\t\t\t\tstring = data;","\t\t\t\tstring = string.match(/currency_wrapper index((.|\\s)*?<\\/div>){5}/);","\t\t\t\tstring = string[0].match(/\\d\\.\\d{4}/g);","\t\t\t\tvar rates = {","\t\t\t\t\t'bankstandard': [{","\t\t\t\t\t\t'date': date,","\t\t\t\t\t\t'timestamp': timestamp","\t\t\t\t\t}, {","\t\t\t\t\t\t'buy_usd': string[1],","\t\t\t\t\t\t'buy_eur': string[3],","\t\t\t\t\t\t'buy_gbp': string[5],","\t\t\t\t\t\t'buy_rub': string[7],","\t\t\t\t\t\t'sell_usd': string[2],","\t\t\t\t\t\t'sell_eur': string[4],","\t\t\t\t\t\t'sell_gbp': string[6],","\t\t\t\t\t\t'sell_rub': string[8]","\t\t\t\t\t}]","\t\t\t\t}","","\t\t\t\trequire('fs').readFile(__dirname + '/../data/bankstandard_rates.json', function(err, data) {","\t\t\t\t\tif (!err) {","\t\t\t\t\t\tvar fileContent = JSON.parse(data.toString());","\t\t\t\t\t\tvar oldData = JSON.stringify(fileContent.bankstandard[1]);","\t\t\t\t\t\tvar newData = JSON.stringify(rates.bankstandard[1]);","\t\t\t\t\t\tif (oldData != newData) {","\t\t\t\t\t\t\trequire('fs').writeFile(__dirname + '/../data/bankstandard_rates.json', JSON.stringify(rates), function(err) {","\t\t\t\t\t\t\t\tif (err) throw err;","\t\t\t\t\t\t\t\tconsole.log(timestamp + '\\tGetRates:\\tBank Standard rates are saved!');","\t\t\t\t\t\t\t\tcallback();","\t\t\t\t\t\t\t});","\t\t\t\t\t\t}","\t\t\t\t\t\telse {","\t\t\t\t\t\t\tconsole.log(timestamp + '\\tGetRates:\\tBank Standard rates has not been changed.');","\t\t\t\t\t\t\tcallback();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\telse {","\t\t\t\t\t\trequire('fs').writeFile(__dirname + '/../data/bankstandard_rates.json', JSON.stringify(rates), function(err) {","\t\t\t\t\t\t\tif (err) throw err;","\t\t\t\t\t\t\tconsole.log(timestamp + '\\tGetRates:\\tBank Standard rates are saved!');","\t\t\t\t\t\t\tcallback();","\t\t\t\t\t\t});","\t\t\t\t\t}","\t\t\t\t});","\t\t\t}","\t\t\tcatch (err) {","\t\t\t\tconsole.log(timestamp + '\\tGetRates:\\tBank Standard rates ERROR ' + err);","\t\t\t\tcallback();","\t\t\t}","\t\t});","\t});","","\treq.on('error', function(e) {","\t\tconsole.error(e);","\t\tcallback();","\t});","","\treq.end();","}"]}],[{"start":{"row":2,"column":26},"end":{"row":2,"column":43},"action":"remove","lines":["ratesBankStandard"],"id":5},{"start":{"row":2,"column":26},"end":{"row":2,"column":27},"action":"insert","lines":["r"]}],[{"start":{"row":2,"column":27},"end":{"row":2,"column":28},"action":"insert","lines":["a"],"id":6}],[{"start":{"row":2,"column":28},"end":{"row":2,"column":29},"action":"insert","lines":["t"],"id":7}],[{"start":{"row":2,"column":29},"end":{"row":2,"column":30},"action":"insert","lines":["e"],"id":8}],[{"start":{"row":2,"column":30},"end":{"row":2,"column":31},"action":"insert","lines":["s"],"id":9}],[{"start":{"row":2,"column":31},"end":{"row":2,"column":32},"action":"insert","lines":["B"],"id":10}],[{"start":{"row":2,"column":32},"end":{"row":2,"column":33},"action":"insert","lines":["a"],"id":11}],[{"start":{"row":2,"column":33},"end":{"row":2,"column":34},"action":"insert","lines":["n"],"id":12}],[{"start":{"row":2,"column":34},"end":{"row":2,"column":35},"action":"insert","lines":["k"],"id":13}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":72,"column":4},"end":{"row":72,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1467117646752,"hash":"196918cb32fba6acc474a6f5dbb6adebc68a3547"}